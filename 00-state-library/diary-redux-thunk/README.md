# ë¦¬ë•ìŠ¤ ë–µí¬(Redux Thunk)
ğŸ“ƒ ê³µì‹ë¬¸ì„œë¥¼ ì½ìœ¼ë©´ì„œ ê³µë¶€í•œ ë‚´ìš©ì„ ì •ë¦¬í•˜ê³ , í† ì´í”„ë¡œì íŠ¸ì— ì§ì ‘ ì ìš©í•´ë´…ë‹ˆë‹¤
<br />

# ğŸ’¡ í•µì‹¬ ê°œë…
> ### ì°¸ê³ ìë£Œ
> [ë¦¬ë•ìŠ¤ ê³µì‹ë¬¸ì„œ - API ì°¸ì¡°](https://redux.js.org/api/applymiddleware)
> [ë¦¬ë•ìŠ¤ ê³µì‹ë¬¸ì„œ - Thunks](https://redux.js.org/usage/writing-logic-thunks)
<br/>
> [Redux Thunk Github](https://github.com/reduxjs/redux-thunk)

## ì½í¬ë€?
"thunk"ë€ ë‹¨ì–´ëŠ” "ì¼ë¶€ ì§€ì—°ëœ ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ì½”ë“œì¡°ê°"ì„ ì˜ë¯¸í•˜ëŠ” í”„ë¡œê·¸ë˜ë° ìš©ì–´ë‹¤. ì¼ë¶€ ë…¼ë¦¬ë¥¼ ì§€ê¸ˆ ì‹¤í–‰í•˜ëŠ” ëŒ€ì‹  í•¨ìˆ˜ ë³¸ë¬¸ì´ë‚˜ ì½”ë“œë¥¼ ë‚˜ì¤‘ì— ì‘ì—…ì„ ìˆ˜í–‰í•˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤. ë¦¬ë•ìŠ¤ ì•±ì—ì„œ ë¹„ë™ê¸° ë…¼ë¦¬ë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•œ í‘œì¤€ ì ‘ê·¼ ë°©ì‹ì´ë©°, ì¼ë°˜ì ìœ¼ë¡œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°ì— ì‚¬ìš©ë˜ì§€ë§Œ ë‹¤ì–‘í•œ ì‘ì—…ì— ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° ë™ê¸°ì‹ ë…¼ë¦¬ì™€ ë¹„ë™ê¸°ì‹ ë…¼ë¦¬ë¥¼ ëª¨ë‘ í¬í•¨í•  ìˆ˜ ìˆë‹¤.

## ì½í¬ì˜ ì‚¬ìš©ë²•
ë¦¬ë•ìŠ¤ ì½”ë“œê°€ dispatchë¥¼ ìœ„í•œ ê°ì²´ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ action creatorë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•˜ê²Œ, dispatchë˜ëŠ” thunkí•¨ìˆ˜ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ thunk action creatorë¥¼ ì‚¬ìš©í•œë‹¤. thunk action creatorëŠ” ì¸ìˆ˜ê°€ ìˆì„ ìˆ˜ ìˆê³ , ìƒˆë¡œìš´ thunkí•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ë‹¤. ê·¸ë¦¬ê³  UIë‹¨ì—ì„œ ì§ì ‘ì ìœ¼ë¡œ í˜¸ì¶œë˜ê¸°ë³´ë‹¨ store.dispatch()ì— ì¸ìˆ˜ë¡œ ë„˜ê²¨ì§„ë‹¤. thunkí•¨ìˆ˜ëŠ” ìŠ¤í† ì–´ì˜ dispatch methodì™€ getStateë©”ì„œë“œ ë‘ê°œì˜ ì¸ìˆ˜ë¥¼ ë°›ëŠ” í•¨ìˆ˜ì´ë‹¤.
```jsx
import getPost from './api.js'

// fetchTodoByIdëŠ” ì½í¬ ì•¡ì…˜ í¬ë¦¬ì—ì´í„°ë‹¤.
export function fetchTodoById(todoId) {
  // fetchTodoByIdThunkëŠ” ì½í¬ í•¨ìˆ˜ë‹¤.
  // ì´ í•¨ìˆ˜ëŠ” 3ê°€ì§€ ì¤‘ì²© í•¨ìˆ˜ë¡œ ì‘ì„±ëœë‹¤.
  // ì•„ìš°í„°í•¨ìˆ˜ëŠ” store APIê°ì²´ì¸ {dispatch, getState}ë¥¼ ë°›ëŠ”ë‹¤.
  // ì¤‘ê°„í•¨ìˆ˜ëŠ” nextì²´ì¸ì˜ ë¯¸ë“¤ì›¨ì–´(í˜¹ì€ ì‹¤ì œ store.dispatchë©”ì„œë“œ)ë¥¼ ë°›ëŠ”ë‹¤.
  // actionì´ë„ˆí•¨ìˆ˜ëŠ” ë¯¸ë“¤ì›¨ì–´ ì²´ì¸ì„ í†µê³¼í•  ë•Œ ê°ê° í˜¸ì¶œëœë‹¤.
  return async function fetchTodoByIdThunk(dispatch, getState) {
    // ë¦¬ë“€ì„œê°€ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ì¦‰ì‹œ ìƒíƒœê°€ ë™ê¸°ì‹ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ë¯€ë¡œ dispatchí›„ì— getStateë¥¼ í˜¸ì¶œí•´ì„œ ì—…ë°ì´íŠ¸ëœ ìƒíƒœë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.
    const firstState = getState() // ì—…ë°ì´íŠ¸ ì „
    dispatch(firstAction());

    const secondState = getState() // ì—…ë°ì´íŠ¸ í›„

    const response = await getPost(todoId)
    dispatch(todosLoaded(response.todos))
    dispatch(todosUpdated(response.todos)) // ì—¬ëŸ¬ë²ˆ dispatchë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŒ
  }

  store.dispatch(fetchTodoByIdThunk)
}
```
ì•„ë˜ëŠ” í™”ì‚´í‘œí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•œ ì˜ˆì œë‹¤.
```jsx
// thunk.jsx
export const fetchTodoById = todoId => async dispatch => {
  const response = await client.get(`/fakeApi/todo/${todoId}`)
  dispatch(todosLoaded(response.todos))
}
```
ë‘ ê²½ìš° ëª¨ë‘ ë‹¤ë¥¸ ë¦¬ë•ìŠ¨ ì•¡ì…˜ì„ ë””ìŠ¤íŒ¨ì¹˜í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•˜ê²Œ ì•¡ì…˜ í¬ë¦¬ì—ì´í„°ë¥¼ í˜¸ì¶œí•´ì„œ thunkë¥¼ ë””ìŠ¤íŒ¨ì¹˜í•œë‹¤.
```jsx
// TodoComponent.jsx
function TodoComponent({ todoId }) {
  const dispatch = useDispatch()

  const onFetchClicked = () => {
    // ì½í¬ ì•¡ì…˜ í¬ë¦¬ì—ì´í„°ë¥¼ í˜¸ì¶œí•˜ê³ , ì½í¬ í•¨ìˆ˜ë¥¼ ë””ìŠ¤íŒ¨ì¹˜ë¡œ ì „ë‹¬í•œë‹¤.
    dispatch(fetchTodoById(todoId))
  }
}
```

## ì½í¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ?
ì½í¬ë¥¼ ì‚¬ìš©í•˜ë©´ UIë ˆì´ì–´ì™€ ë³„ë„ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì¶”ê°€ì ì¸ Reduxê´€ë ¨ ë¡œì§ì„ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.
* ë¹„ë™ê¸° ìš”ì²­ ë˜ëŠ” ì„ì˜ ê°’ ìƒì„±ê³¼ ê°™ì€ ë¶€ìˆ˜íš¨ê³¼(side effects)ì²˜ë¦¬í•˜ê¸° (Q. ì—¬ê¸°ì„œ ë§í•˜ëŠ” ë¶€ìˆ˜íš¨ê³¼ëŠ” ì™¸ë¶€ë³€ìˆ˜ë¡œ ì¸í•´ ì¸ìˆ˜ê°€ ë°”ë€ŒëŠ” ê²½ìš°ë¥¼ ë§í•˜ëŠ”ê²ƒ?)
* ì—¬ëŸ¬ ì‘ì—…ì„ ë””ìŠ¤íŒ¨ì¹˜í•˜ê±°ë‚˜, getStateë©”ì„œë“œë¥¼ í†µí•´ ë¦¬ë•ìŠ¤ ìŠ¤í† ì–´ì˜ stateì— ì ‘ê·¼í•´ì•¼í•˜ëŠ” ë¡œì§

ë¦¬ë•ìŠ¤ ë¦¬ë“€ì„œì—” ë¶€ìˆ˜íš¨ê³¼ê°€ ìˆì–´ì„  ì•ˆë˜ì§€ë§Œ, ì‹¤ì œ ì•±ì—” ë¶€ìˆ˜íš¨ê³¼ê°€ ìˆëŠ” ë¡œì§ì´ í•„ìš”í•˜ë‹¤. ê·¸ ì¤‘ ì¼ë¶€ëŠ” ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— ìˆì„ ìˆ˜ë„ ìˆì§€ë§Œ ì¼ë¶€ëŠ” **UIë ˆì´ì•„ì›ƒ ì™¸ë¶€ì— ìˆì–´ì•¼ í•  ìˆ˜ë„ ìˆë‹¤**. ì½í¬ ë° ê¸°íƒ€ ë¦¬ë•ìŠ¤ ë¯¸ë“¤ì›¨ì–´ëŠ” ì´ëŸ° ë¶€ìˆ˜íš¨ê³¼ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆëŠ” **ì™¸ë¶€ ì¥ì†Œ**ë¥¼ ì œê³µí•œë‹¤.

ì–´ë–¤ ì˜ë¯¸ì—ì„œ ì½í¬ëŠ” ì–´ë–¤ ë¦¬ë•ìŠ¤ ìŠ¤í† ì–´ê°€ ì‚¬ìš©ë ì§€ ì•Œ í•„ìš”ì—†ì´ ë¦¬ë•ìŠ¤ ìŠ¤í† ì–´ì™€ ìƒí˜¸ ì‘ìš©í•´ì•¼ í•˜ëŠ” ì½”ë“œë¥¼ ë¯¸ë¦¬ ì‘ì„±í•  ìˆ˜ ìˆëŠ” ì°½êµ¬ì´ë‹¤. ì´ë ‡ê²Œ í•˜ë©´ ë¡œì§ì´ íŠ¹ì • ë¦¬ë•ìŠ¤ ìŠ¤í† ì–´ ì¸ìŠ¤í„´ìŠ¤ì— ë°”ì¸ë”©ë˜ì§€ ì•Šê³ , ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ìƒíƒœë¡œ ìœ ì§€ëœë‹¤.

ì½í¬ëŠ” ê²°êµ­ ì„ì˜ì˜ ë…¼ë¦¬ë¥¼ í¬í•¨í•  ìˆ˜ ìˆëŠ” ë²”ìš© ë„êµ¬ë¡œ, ë‹¤ì–‘í•œ ìš©ë„ë¡œ ì‚¬ìš©ë  ìˆ˜ ìˆë‹¤. ê°€ì¥ ì¼ë°˜ì ì¸ ì‚¬ìš©ì‚¬ë¡€ëŠ” ì•„ë˜ì™€ ê°™ë‹¤. ì½í¬ëŠ” ìƒëª…ì£¼ê¸°ê°€ ì—†ëŠ” ë‹¨ë°œì„± ê¸°ëŠ¥ì´ë‹¤.
* ì»´í¬ë„ŒíŠ¸ì—ì„œ ë³µì¡í•´ì§„ ë¡œì§ ì˜®ê¸°ê¸°
* ajaxìš”ì²­ì„ ë§Œë“¤ê³  ìš”ì²­ ê²°ê³¼ì— ë”°ë¼ ì•¡ì…˜ì„ dispatchí•˜ëŠ” ê²ƒê³¼ ê°™ì€ ë¹„ë™ê¸° ë¡œì§ì„ ë§Œë“¤ ë•Œ
* ì—°ì†ì ìœ¼ë¡œ ë˜ëŠ” íƒ€ì„ë¼ì¸ì— ë”°ë¼ ì—¬ëŸ¬ ì‘ì—…ì„ ì „ë‹¬í•´ì•¼í•˜ëŠ” ë¡œì§ì„ ë§Œë“¤ ë•Œ
* ì•¡ì…˜ì— ë‹¤ë¥¸ ìƒíƒœê°’ì„ í¬í•¨ì‹œí‚¤ê¸° ìœ„í•´ `getState`ì ‘ê·¼ê¶Œí•œì´ í•„ìš”í•œ ë¡œì§ì„ ë§Œë“¤ ë•Œ

## ë¯¸ë“¤ì›¨ì–´ë€?
ë¯¸ë“¤ì›¨ì–´ëŠ” Reduxë¥¼ í™•ì¥í•˜ëŠ” ì»¤ìŠ¤í…€ ê¸°ëŠ¥ì´ë©°, ìŠ¤í† ì–´ì˜ dispatch ë©”ì†Œë“œë¥¼ ê°ì‹¸ì¤€ë‹¤. ë¯¸ë“¤ì›¨ì–´ì˜ í•µì‹¬ê¸°ëŠ¥ì€ composableí•˜ë‹¤ëŠ” ê²ƒì´ë‹¤. ì¦‰, ì—¬ëŸ¬ ë¯¸ë“¤ì›¨ì–´ë¥¼ í•¨ê»˜ ê²°í•©í•  ìˆ˜ ìˆê³ , ì—¬ê¸°ì„œ ê° ë¯¸ë“¤ì›¨ì–´ëŠ” ì²´ì¸ì˜ ì „í›„ì— ëŒ€í•œ ì§€ì‹ì´ í•„ìš”í•˜ì§€ ì•Šë‹¤.

ë¯¸ë“¤ì›¨ì–´ì˜ ê°€ì¥ ì¼ë°˜ì ì¸ ì‚¬ìš© ì‚¬ë¡€ëŠ” Rxê°™ì€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ëŒ€í•œ ì¢…ì†ì„±ì´ë‚˜ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ì½”ë“œì—†ì´ ë¹„ë™ê¸° ì‘ì—…ì„ ì§€ì›í•˜ëŠ” ê²ƒì´ë‹¤. ì¼ë°˜ ì‘ì—… ì™¸ì—ë„ ë¹„ë™ê¸° ì‘ì—…ì„ dispatch í•  ìˆ˜ ìˆê²Œ í•´ì¤€ë‹¤. ë¯¸ë“¤ì›¨ì–´ëŠ” createStoreì— í¬í•¨ë˜ì§€ ì•Šì•˜ê³ , ë¦¬ë•ìŠ¤ ì•„í‚¤í…ì²˜ì˜ ê·¼ë³¸ì ì¸ ë¶€ë¶„ì€ ì•„ë‹ˆì§€ë§Œ í•µì‹¬ì ìœ¼ë¡œ ì§€ì›ë  ë§Œí¼ ìœ ìš©í•˜ê²Œ ì“°ì¸ë‹¤.

## ì‚¬ìš©ë²•
applyMiddlewareëŠ” Reduxë¯¸ë“¤ì›¨ì–´ apië¥¼ ì¤€ìˆ˜í•˜ëŠ” í•¨ìˆ˜ë‹¤. ì•„ë˜ ì˜ˆì‹œì—ì„œ ë³´ë©´, getStateí•¨ìˆ˜ë¥¼ ì¸ìˆ˜ë¡œ ë°›ëŠ” ìŠ¤í† ì–´ì˜ dispatchë©”ì„œë“œ(logger)ë¥¼ applyMiddlewareì˜ ì¸ìˆ˜ë¡œ ì „ë‹¬í•˜ê³ , ìµëª…í•¨ìˆ˜ë¥¼ ë¦¬í„´í•œë‹¤. í•´ë‹¹ í•¨ìˆ˜ì—ëŠ” ë¯¸ë“¤ì›¨ì–´ì˜ next ë””ìŠ¤íŒ¨ì¹˜ ë©”ì„œë“œê°€ ì œê³µë˜ë©° nextí•¨ìˆ˜ì— actionì„ ì¸ìˆ˜ë¡œ ì „ë‹¬í•´ì„œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ê°’ìœ¼ë¡œ ë°˜í™˜í•˜ê±°ë‚˜, ì•„ì˜ˆ í˜¸ì¶œë˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤. ì²´ì¸ì˜ ë§ˆì§€ë§‰ ë¯¸ë“¤ì›¨ì–´ëŠ” ì‹¤ì œ storeì˜ ë©”ì„œë“œë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ìˆ˜ì‹ í•´ì„œ ì²´ì¸ì„ ì¢…ë£Œí•œë‹¤. ë”°ë¼ì„œ `({getState, dispatch}) => next => action`... ???

```jsx
import { createStore, applyMiddleware } from 'redux';
// todos ë¦¬ë“€ì„œ
import todos from './reducers';

function logger({ getState }) {
  return next => (action) => {
    console.log('will dispatch', action)

    // ë¯¸ë“¤ì›¨ì–´ ì²´ì¸ì˜ ë‹¤ìŒ ë””ìŠ¤íŒ¨ì¹˜ ë°©ë²•ì„ í˜¸ì¶œí•œë‹¤.
    const returnValue = next(action)

    console.log('state after dispatch', getState())

    // ë¯¸ë“¤ì›¨ì–´ê°€ ì´ë¥¼ ë³€ê²½í•˜ì§€ ì•ŠëŠ” í•œ, ì´ëŠ” ì‘ì—… ìì²´ê°€ ë  ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.
    return returnValue
  }
}

const store = createStore(todos, ['Use Redux'], applyMiddleware(logger))

store.dispatch({
  type: 'ADD_TODO',
  text: 'Understand the middleware'
})
// ì´ ë¼ì¸ì€ ë¯¸ë“¤ì›¨ì–´ì— ì˜í•´ ê¸°ë¡ëœë‹¤.
// dispatchì˜ˆì •: { type: 'ADD_TODO', text: 'Understand the middleware' }
// dispatchí›„ ìƒíƒœ: [ 'Use Redux', 'Understand the middleware' ]
```
